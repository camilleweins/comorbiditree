<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>The Comorbiditree</title>
    <script src="p5.min.js"></script>
    <script src="p5.dom.min.js"></script>
    <script src="p5.sound.min.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css">
    <meta charset="utf-8">
    <!-- Google fonts -->
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Raleway' rel='stylesheet' type='text/css'>
    <!-- D3.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
</head>

<body>
    <div class="blood-volume-stats">
        <label>Height(in.)</label>
        <input type="text" name="height" id="height">
        <br>
        <label>Weight(lbs)</label>
        <input type="text" name="weight" id="weight">
        <br>
    </div>
    <div class="blood-volume">
        <h3>Estimated Blood Volume</h3>
        <div id="blood-volume-value"></div>
    </div>
    <div class="radarChart"></div>
    <div class="a1c">
        <h3>Predicted a1c Value</h3>
        <div id="a1c-value"></div>
    </div>
    <div class="stats">
        <label>Blood sugar(mg/dL)</label>
        <input type="text" name="sugar" id="sugar">
        <br>
        <label>Exercise duration(mins)</label>
        <input type="text" name="exercise" id="exercise">
        <br>
    </div>
    <input type="submit" onclick="run()">
    <script src="graph.js"></script>
    <script>
    // global variable puragtory
    let sugar = document.getElementById('sugar');
    let exercise = document.getElementById('exercise');

    // variables for the equations
    let vein, foot, numb, kidney, heart;

    // initialize
    let dataset = [];
    /* Radar chart design created by Nadieh Bremer - VisualCinnamon.com */

    ////////////////////////////////////////////////////////////// 
    //////////////////////// Set-Up ////////////////////////////// 
    ////////////////////////////////////////////////////////////// 

    let margin = { top: 100, right: 100, bottom: 100, left: 100 },
        width = Math.min(700, window.innerWidth - 10) - margin.left - margin.right,
        height = Math.min(width, window.innerHeight - margin.top - margin.bottom - 20);

    // array of sugar values
    let a1c = [];

    function run() {
        let sugarValue = parseInt(sugar.value);
        let exerciseValue = parseInt(exercise.value);
        let scaler = 250;

        vein = Math.abs((sugarValue * .19) / scaler - exerciseValue / scaler);
        foot = Math.abs((sugarValue * .15) / scaler - exerciseValue / scaler);
        numb = Math.abs((sugarValue * .5) / scaler - exerciseValue / scaler);
        kidney = Math.abs((sugarValue * .25) / scaler - exerciseValue / scaler);
        heart = Math.abs((sugarValue * .75) / scaler - exerciseValue / scaler);

        let data = [];

        data.push({ axis: "Vein Disease", value: vein }, { axis: "Foot Ulcers", value: foot }, { axis: "Numbness", value: numb }, { axis: "Kidney Failure", value: kidney }, { axis: "Heart Disease", value: heart }, );

        console.log(data);

        //make our collection of data
        dataset.push(data);

        console.log(dataset);

        // draw the chart
        //we need to draw multiple charts though
        RadarChart(".radarChart", dataset, radarChartOptions);

        //push sugar values into array on submission
        a1c.push(parseInt(sugarValue));

        // an estimation of a1c value
        let total = 0;
        for (let i = 0; i < a1c.length; i++) {
            total += a1c[i];
        }

        // only calculate average if there's more than one item in array
        if (a1c.length > 1) {
            let average = total / a1c.length;
            let a1cValue = (average + 46.7) / 28.7;
            console.log(average);

            // output value to the div
            let a1cContainer = document.getElementById("a1c-value");
            a1cContainer.innerHTML = a1cValue;

            console.log(a1cValue);

        }

        let calcHeight = document.getElementById('height');
        let calcWeight = document.getElementById('weight');

        let heightValue = parseInt(calcHeight.value)/39.37;
        let weightValue = parseInt(calcWeight.value)/2.205;

        //only use the female equation because mother
        //convert to US
        //let bV = ((0.3561*(heightValue/39.37)^3)+(0.03308*(weightValue/2.205) + 0.1833));
        let bV = ((0.3561* Math.pow(heightValue, 3))+(0.03308*(weightValue) + 0.1833));


        console.log(bV);

        let bVContainer = document.getElementById("blood-volume-value");
        bVContainer.innerHTML = '~' + Math.round(bV) + ' L';

        // we'll draw a container that represents you bv
        //fill it with particles
        //adjust the color

        //milligrams per decilitre
        //times the deciliter volume value by .10

    }

    ////////////////////////////////////////////////////////////// 
    //////////////////// Draw the Chart ////////////////////////// 
    ////////////////////////////////////////////////////////////// 

    let color = d3.scale.ordinal()
        .range(["#ff6600", "#CC333F", "#00A0B0", "#7848c0"]);

    let radarChartOptions = {
        w: width,
        h: height,
        margin: margin,
        maxValue: 1,
        levels: 10,
        roundStrokes: true,
        color: color
    };
    //Call function to draw the Radar chart
    // RadarChart(".radarChart", data, radarChartOptions);
    </script>
</body>

</html>